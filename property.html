<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Property — The Vintage Realtors</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>
<body class="property-page">
    <nav>
        <a href="index.html" class="logo-container">
            <img src="images/logo.avif" alt="The Vintage Realtors logo" class="logo-img">
        </a>
        <div class="site-title"><span>THE VINTAGE REALTORS</span></div>
        <button class="hamburger" aria-label="Open menu" aria-expanded="false"><span></span><span></span><span></span></button>
    </nav>

    <main style="max-width:1100px;margin:60px auto;padding:24px;">
        <div id="propertyDetail" class="property-detail">Loading…</div>
    </main>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-logo"><img src="images/FOOTER%20LOGO.avif" alt="Footer logo"></div>
            <div class="footer-about"><h3>The Vintage Realtors</h3><p>If you build it, we will list it.</p><p>Nairobi, Kenya</p></div>
            <div class="footer-contact"><h4>Contact</h4><p>Email: <a href="mailto:sales@vintagerealtors.co.ke">sales@vintagerealtors.co.ke</a></p><p>Phone: <a href="tel:+254722865306">+254722865306</a></p></div>
        </div>
    </footer>

    <script>
    (function(){
        function qs(key){ const params = new URLSearchParams(location.search); return params.get(key); }
        const id = parseInt(qs('property'),10);
        const container = document.getElementById('propertyDetail');
        if(!id){ container.innerHTML = '<p>Property not specified. <a href="properties.html">View other properties</a></p>'; return; }

        fetch('properties.json')
            .then(r => r.ok ? r.json() : Promise.reject('Failed to load'))
            .then(data => {
                const it = data.find(d => d.id === id);
                if(!it){ container.innerHTML = '<p>Property not found. <a href="properties.html">View other properties</a></p>'; return; }

                function renderGallery(gallery){
                    if(!gallery || !gallery.length) return '';
                    return `
                        <div class="pd-gallery">
                            <div class="pd-main"><img src="${gallery[0]}" alt="${it.title}" data-full="${gallery[0]}"></div>
                            <div class="pd-thumbs">${gallery.map(g => `<button class="thumb" data-src="${g}" aria-label="View image"><img src="${g}" alt="${it.title}" /></button>`).join('')}</div>
                        </div>
                    `;
                }

                function amenityIcon(ok, label){ return `<div class="amenity ${ok? 'yes':'no'}"><span class="am-icon">${ok? '✓':'✕'}</span><span class="am-label">${label}</span></div>`; }

                container.innerHTML = `
                    <article class="pd-card">
                        ${renderGallery(it.gallery)}
                        <div class="pd-body">
                            <h1 class="pd-title">${it.title}</h1>
                            <div class="pd-meta"><span class="pd-price">${it.price}</span> · <span>${it.type}</span> · <span>${it.area || ''}</span></div>
                            <p class="pd-desc">${it.description || ''}</p>
                            <div class="pd-specs">
                                ${it.beds ? `<strong>${it.beds} bd</strong>` : ''}
                                ${it.baths ? `<strong>${it.baths} ba</strong>` : ''}
                            </div>
                            <div class="pd-amenities">
                                ${amenityIcon(it.petsAllowed,'Pets allowed')}
                                ${amenityIcon(it.pool,'Swimming pool')}
                                ${amenityIcon(it.water24,'24/7 water')}
                                ${amenityIcon(it.security,'Security')}
                            </div>
                            <div class="pd-actions">
                                <a href="contact.html?property=${it.id}" class="btn-primary">Contact about this property</a>
                                <a href="properties.html" class="btn-secondary">View other properties</a>
                            </div>
                        </div>
                    </article>
                `;

                // thumbnail clicks swap main and open lightbox when clicking main image
                const mainImg = container.querySelector('.pd-main img');
                const thumbs = Array.from(container.querySelectorAll('.pd-thumbs .thumb'));
                thumbs.forEach(t => t.addEventListener('click', () => { mainImg.src = t.dataset.src; mainImg.dataset.full = t.dataset.src; }));

                // lightbox: create modal once
                let lightbox = document.querySelector('.lightbox');
                if(!lightbox){
                    lightbox = document.createElement('div');
                    lightbox.className = 'lightbox';
                    lightbox.innerHTML = '<div class="lightbox-inner"><button class="lb-close" aria-label="Close">×</button><img src="" alt=""></div>';
                    document.body.appendChild(lightbox);
                    lightbox.querySelector('.lb-close').addEventListener('click', () => { lightbox.classList.remove('open'); });
                    lightbox.addEventListener('click', (e) => { if(e.target === lightbox) lightbox.classList.remove('open'); });
                }

                function openLightbox(src){ const img = lightbox.querySelector('img'); img.src = src; lightbox.classList.add('open'); }
                mainImg && mainImg.addEventListener('click', () => openLightbox(mainImg.dataset.full || mainImg.src));
                thumbs.forEach(t => t.addEventListener('dblclick', () => openLightbox(t.dataset.src)));
            })
            .catch(err => { console.error(err); container.innerHTML = '<p>Unable to load property.</p>'; });
    })();
    </script>
</body>
</html>
